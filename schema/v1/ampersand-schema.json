{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Ampersand Manifest Schema",
  "description": "Schema for defining Ampersand integrations in amp.yaml files. Used to configure data synchronization and integration between various SaaS platforms.",
  "type": "object",
  "required": [
    "specVersion",
    "integrations"
  ],
  "properties": {
    "specVersion": {
      "type": "string",
      "description": "The version of the manifest specification. Currently only 1.0.0 is supported. Future versions may introduce breaking changes.",
      "enum": [
        "1.0.0"
      ],
      "examples": [
        "1.0.0"
      ]
    },
    "integrations": {
      "type": "array",
      "description": "An array of integration configurations. Each integration defines connectivity with a specific provider (e.g., Salesforce, HubSpot, GitHub).",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/integration"
      },
      "examples": [
        [
          {
            "name": "salesforce-contacts",
            "displayName": "Salesforce Contacts",
            "provider": "salesforce",
            "read": {
              "objects": [
                {
                  "objectName": "contact",
                  "destination": "defaultWebhook",
                  "schedule": "*/30 * * * *",
                  "requiredFields": [
                    {
                      "fieldName": "FirstName"
                    },
                    {
                      "fieldName": "LastName"
                    },
                    {
                      "fieldName": "Email"
                    }
                  ]
                }
              ]
            }
          }
        ]
      ]
    }
  },
  "definitions": {
    "integration": {
      "type": "object",
      "required": [
        "name",
        "provider"
      ],
      "description": "Configuration for an integration with a specific provider like Salesforce, HubSpot, etc.",
      "properties": {
        "name": {
          "type": "string",
          "description": "A unique identifier for this integration. Used in logs and as a reference. Use lowercase alphanumeric characters, hyphens and underscores only.",
          "pattern": "^[a-z0-9_-]+$",
          "maxLength": 64,
          "examples": [
            "salesforce-contacts",
            "hubspot-integration",
            "github-issues-tracker"
          ]
        },
        "displayName": {
          "type": "string",
          "description": "A human-readable name for this integration. This name is displayed in the UI and logs. Use proper capitalization for better readability.",
          "maxLength": 100,
          "examples": [
            "Salesforce Contacts",
            "HubSpot CRM Integration",
            "GitHub Issues Tracker"
          ]
        },
        "provider": {
          "type": "string",
          "description": "The provider/platform for this integration. Must be one of the supported providers. This determines which API endpoints and authentication methods are used.",
          "examples": [
            "salesforce",
            "hubspot",
            "github",
            "intercom",
            "stripe"
          ]
        },
        "read": {
          "$ref": "#/definitions/read",
          "description": "Configuration for reading data from the provider."
        },
        "write": {
          "$ref": "#/definitions/write",
          "description": "Configuration for writing data to the provider."
        },
        "subscribe": {
          "$ref": "#/definitions/subscribe",
          "description": "Configuration for subscribing to events from the provider."
        },
        "proxy": {
          "$ref": "#/definitions/proxy",
          "description": "Configuration for proxying API calls to the provider."
        }
      },
      "examples": [
        {
          "name": "salesforce-full-integration",
          "displayName": "Salesforce Full Integration",
          "provider": "salesforce",
          "read": {
            "objects": [
              {
                "objectName": "contact",
                "destination": "salesforceWebhook",
                "schedule": "*/30 * * * *",
                "requiredFields": [
                  {
                    "fieldName": "FirstName"
                  },
                  {
                    "fieldName": "LastName"
                  },
                  {
                    "fieldName": "Email"
                  }
                ],
                "optionalFieldsAuto": "all"
              },
              {
                "objectName": "lead",
                "destination": "salesforceWebhook",
                "schedule": "*/30 * * * *",
                "requiredFields": [
                  {
                    "fieldName": "FirstName"
                  },
                  {
                    "fieldName": "LastName"
                  },
                  {
                    "fieldName": "Email"
                  },
                  {
                    "fieldName": "Company"
                  }
                ],
                "optionalFieldsAuto": "all"
              }
            ]
          },
          "write": {
            "objects": [
              {
                "objectName": "contact",
                "inheritMapping": true
              },
              {
                "objectName": "lead",
                "inheritMapping": true
              }
            ]
          },
          "proxy": {
            "enabled": true
          }
        }
      ]
    },
    "read": {
      "type": "object",
      "description": "Configuration for reading data from the provider. Defines what data to read, how frequently, and where to send it.",
      "required": [
        "objects"
      ],
      "properties": {
        "objects": {
          "type": "array",
          "description": "List of objects to read from the provider. Each object represents a data type like contacts, leads, etc.",
          "items": {
            "$ref": "#/definitions/readObject"
          },
          "examples": [
            [
              {
                "objectName": "contact",
                "destination": "webhookName",
                "schedule": "*/30 * * * *",
                "requiredFields": [
                  {
                    "fieldName": "FirstName"
                  },
                  {
                    "fieldName": "LastName"
                  }
                ]
              }
            ]
          ]
        }
      },
      "examples": [
        {
          "objects": [
            {
              "objectName": "contact",
              "destination": "salesforceWebhook",
              "schedule": "*/30 * * * *",
              "requiredFields": [
                {
                  "fieldName": "FirstName"
                },
                {
                  "fieldName": "LastName"
                },
                {
                  "fieldName": "Email"
                }
              ],
              "optionalFieldsAuto": "all",
              "backfill": {
                "defaultPeriod": {
                  "fullHistory": true
                }
              }
            },
            {
              "objectName": "lead",
              "destination": "salesforceWebhook",
              "schedule": "0 * * * *",
              "requiredFields": [
                {
                  "fieldName": "FirstName"
                },
                {
                  "fieldName": "LastName"
                },
                {
                  "fieldName": "Email"
                },
                {
                  "fieldName": "Company"
                }
              ],
              "optionalFields": [
                {
                  "fieldName": "Phone"
                },
                {
                  "fieldName": "Title"
                }
              ]
            }
          ]
        }
      ]
    },
    "readObject": {
      "type": "object",
      "description": "Configuration for a specific object to read. Defines which fields to read and how to handle the data.",
      "required": [
        "objectName",
        "destination",
        "schedule",
        "requiredFields"
      ],
      "properties": {
        "objectName": {
          "type": "string",
          "description": "The name of the object to read in the provider's API (e.g., 'contact', 'lead', 'account'). Must match an object type supported by the provider.",
          "examples": [
            "contact",
            "lead",
            "account",
            "opportunity"
          ]
        },
        "mapToName": {
          "type": "string",
          "description": "An optional name mapping for this object. Used to standardize object names across different providers in your data model.",
          "examples": [
            "customer",
            "prospect",
            "company"
          ]
        },
        "mapToDisplayName": {
          "type": "string",
          "description": "An optional display name mapping for this object. Used for UI display and documentation.",
          "examples": [
            "Customer",
            "Sales Prospect",
            "Company"
          ]
        },
        "destination": {
          "type": "string",
          "description": "The webhook destination for the read data. This determines where the data will be sent after it's read. Must match a webhook configured in your Ampersand account.",
          "examples": [
            "salesforceWebhook",
            "defaultWebhook",
            "customWebhook"
          ]
        },
        "schedule": {
          "type": "string",
          "description": "A cron schedule for reading the data. Defines how frequently the data should be read. Uses standard cron syntax with five fields (minutes, hours, day of month, month, day of week).",
          "pattern": "^(\\*|[0-5]?[0-9]|\\*/[0-9]+)\\s+(\\*|[01]?[0-9]|2[0-3]|\\*/[0-9]+)\\s+(\\*|[0-2]?[0-9]|3[01]|\\*/[0-9]+)\\s+(\\*|[0]?[0-9]|1[0-2]|\\*/[0-9]+)\\s+(\\*|[0-6]|\\*/[0-9]+)$",
          "examples": [
            "*/10 * * * *",
            "*/30 * * * *",
            "0 * * * *",
            "0 0 * * *"
          ]
        },
        "requiredFields": {
          "type": "array",
          "description": "Fields that are always read for every customer. These fields will always be included in the data that's read.",
          "items": {
            "$ref": "#/definitions/field"
          },
          "examples": [
            [
              {
                "fieldName": "FirstName"
              },
              {
                "fieldName": "LastName"
              },
              {
                "fieldName": "Email"
              }
            ]
          ]
        },
        "optionalFields": {
          "type": "array",
          "description": "Optional fields that can be included. Customers can choose which of these fields to include. Use this for fields that aren't essential.",
          "items": {
            "$ref": "#/definitions/field"
          },
          "examples": [
            [
              {
                "fieldName": "Phone"
              },
              {
                "fieldName": "Title"
              },
              {
                "fieldName": "Address"
              }
            ]
          ]
        },
        "optionalFieldsAuto": {
          "type": "string",
          "description": "Set to 'all' to automatically include all available fields as optional. This can be used instead of explicitly listing optional fields.",
          "enum": [
            "all"
          ],
          "examples": [
            "all"
          ]
        },
        "backfill": {
          "type": "object",
          "description": "Configuration for backfilling historical data. Defines how historical data should be loaded during initial sync.",
          "properties": {
            "defaultPeriod": {
              "type": "object",
              "description": "The default time period for backfilling.",
              "properties": {
                "fullHistory": {
                  "type": "boolean",
                  "description": "Whether to backfill the full history (true) or just recent data (false). Full history may take longer for large datasets.",
                  "examples": [
                    true,
                    false
                  ]
                },
                "days": {
                  "type": "integer",
                  "description": "Number of days in past to backfill from. 0 is no backfill. e.g) if 10, then backfill last 10 days of data.",
                  "minimum": 0,
                  "examples": [
                    30,
                    60,
                    90
                  ]
                }
              }
            }
          },
          "examples": [
            {
              "defaultPeriod": {
                "fullHistory": true
              }
            },
            {
              "defaultPeriod": {
                "days": 30
              }
            }
          ]
        },
        "delivery": {
          "type": "object",
          "description": "Configuration for how data is delivered to the destination.",
          "properties": {
            "mode": {
              "type": "string",
              "description": "The delivery mode. 'auto' delivers data as soon as it's read, 'onRequest' stores data until explicitly requested.",
              "enum": [
                "auto",
                "onRequest"
              ],
              "default": "auto",
              "examples": [
                "auto",
                "onRequest"
              ]
            },
            "pageSize": {
              "type": "integer",
              "description": "The number of records to deliver per page when using onRequest mode.",
              "minimum": 50,
              "maximum": 500,
              "examples": [
                50,
                100,
                200
              ]
            }
          },
          "examples": [
            {
              "mode": "onRequest",
              "pageSize": 100
            }
          ]
        }
      },
      "examples": [
        {
          "objectName": "contact",
          "destination": "salesforceWebhook",
          "schedule": "*/30 * * * *",
          "requiredFields": [
            {
              "fieldName": "FirstName"
            },
            {
              "fieldName": "LastName"
            },
            {
              "fieldName": "Email"
            }
          ],
          "optionalFieldsAuto": "all",
          "backfill": {
            "defaultPeriod": {
              "fullHistory": true
            }
          }
        },
        {
          "objectName": "lead",
          "mapToName": "prospect",
          "mapToDisplayName": "Sales Prospect",
          "destination": "salesforceWebhook",
          "schedule": "0 * * * *",
          "requiredFields": [
            {
              "fieldName": "FirstName"
            },
            {
              "fieldName": "LastName"
            },
            {
              "fieldName": "Email"
            },
            {
              "mapToName": "priority",
              "mapToDisplayName": "Priority Score",
              "prompt": "Which field do you use to track the priority of a lead?"
            }
          ],
          "optionalFields": [
            {
              "fieldName": "Phone"
            },
            {
              "fieldName": "Title"
            }
          ]
        }
      ]
    },
    "field": {
      "type": "object",
      "description": "Configuration for a field to read or write. Fields can be specified by simple name or with mappings and prompts.",
      "oneOf": [
        {
          "required": [
            "fieldName"
          ],
          "properties": {
            "fieldName": {
              "type": "string",
              "description": "The name of the field in the provider's API. Must match a field available in the provider's API for the specified object.",
              "examples": [
                "FirstName",
                "LastName",
                "Email",
                "Phone"
              ]
            },
            "mapToName": {
              "type": "string",
              "description": "An optional name mapping for this field. Used to standardize field names across different providers in your data model.",
              "examples": [
                "first_name",
                "last_name",
                "email_address"
              ]
            },
            "mapToDisplayName": {
              "type": "string",
              "description": "An optional display name mapping for this field. Used for UI display and documentation.",
              "examples": [
                "First Name",
                "Last Name",
                "Email Address"
              ]
            }
          },
          "examples": [
            {
              "fieldName": "FirstName",
              "mapToName": "first_name",
              "mapToDisplayName": "First Name"
            },
            {
              "fieldName": "Email"
            }
          ]
        },
        {
          "required": [
            "mapToName",
            "mapToDisplayName",
            "prompt"
          ],
          "properties": {
            "mapToName": {
              "type": "string",
              "description": "A name mapping for this field in your data model. Used when the field name varies across providers or customers.",
              "examples": [
                "priority",
                "status",
                "linkedin_url"
              ]
            },
            "mapToDisplayName": {
              "type": "string",
              "description": "A display name mapping for this field. Used in the UI when prompting users to select fields.",
              "examples": [
                "Priority Score",
                "Status",
                "LinkedIn URL"
              ]
            },
            "prompt": {
              "type": "string",
              "description": "A prompt to show when configuring this field. Helps users understand what the field is for or to select the appropriate field.",
              "examples": [
                "Which field do you use to track the priority of a lead?",
                "Select the field you use for tracking LinkedIn profiles"
              ]
            }
          },
          "examples": [
            {
              "mapToName": "priority",
              "mapToDisplayName": "Priority Score",
              "prompt": "Which field do you use to track the priority of a lead?"
            },
            {
              "mapToName": "linkedin_url",
              "mapToDisplayName": "LinkedIn URL",
              "prompt": "Which field do you use for the LinkedIn URL for the contact?"
            }
          ]
        }
      ],
      "examples": [
        {
          "fieldName": "FirstName",
          "mapToName": "first_name",
          "mapToDisplayName": "First Name"
        },
        {
          "fieldName": "Email"
        },
        {
          "mapToName": "priority",
          "mapToDisplayName": "Priority Score",
          "prompt": "Which field do you use to track the priority of a lead?"
        }
      ]
    },
    "write": {
      "type": "object",
      "description": "Configuration for writing data to the provider. Defines what objects can be written to.",
      "required": [
        "objects"
      ],
      "properties": {
        "objects": {
          "type": "array",
          "description": "List of objects that can be written to. Each object represents a data type that can be created or updated.",
          "items": {
            "$ref": "#/definitions/writeObject"
          },
          "examples": [
            [
              {
                "objectName": "contact",
                "inheritMapping": true
              },
              {
                "objectName": "lead"
              }
            ]
          ]
        }
      },
      "examples": [
        {
          "objects": [
            {
              "objectName": "contact",
              "inheritMapping": true
            },
            {
              "objectName": "lead",
              "inheritMapping": true
            },
            {
              "objectName": "account"
            }
          ]
        }
      ]
    },
    "writeObject": {
      "type": "object",
      "description": "Configuration for a specific object to write to. Defines what data can be written to this object type.",
      "required": [
        "objectName"
      ],
      "properties": {
        "objectName": {
          "type": "string",
          "description": "The name of the object to write to in the provider's API. Must match an object type that can be written to in the provider's API.",
          "examples": [
            "contact",
            "lead",
            "account",
            "opportunity"
          ]
        },
        "inheritMapping": {
          "type": "boolean",
          "description": "Whether to inherit mappings from read configuration. If true, field mappings defined in the read configuration will be used for writing, which simplifies configuration for bidirectional syncs.",
          "examples": [
            true,
            false
          ]
        }
      },
      "examples": [
        {
          "objectName": "contact",
          "inheritMapping": true
        },
        {
          "objectName": "lead"
        }
      ]
    },
    "subscribe": {
      "type": "object",
      "description": "Configuration for subscribing to events from the provider. Defines what objects to subscribe to for events.",
      "required": [
        "objects"
      ],
      "properties": {
        "objects": {
          "type": "array",
          "description": "List of objects to subscribe to. Each object represents a specific data type to receive events for.",
          "items": {
            "$ref": "#/definitions/subscribeObject"
          },
          "examples": [
            [
              {
                "objectName": "account",
                "destination": "accountWebhook",
                "inheritFieldsAndMapping": true,
                "createEvent": {
                  "enabled": "always"
                },
                "updateEvent": {
                  "enabled": "always",
                  "watchFieldsAuto": "all"
                },
                "deleteEvent": {
                  "enabled": "always"
                }
              }
            ]
          ]
        }
      },
      "examples": [
        {
          "objects": [
            {
              "objectName": "account",
              "destination": "accountWebhook",
              "inheritFieldsAndMapping": true,
              "createEvent": {
                "enabled": "always"
              },
              "updateEvent": {
                "enabled": "always",
                "watchFieldsAuto": "all"
              },
              "deleteEvent": {
                "enabled": "always"
              }
            }
          ]
        }
      ]
    },
    "subscribeObject": {
      "type": "object",
      "description": "Configuration for a specific object to subscribe to. Defines what events to listen for on this object.",
      "required": [
        "objectName",
        "destination",
        "inheritFieldsAndMapping"
      ],
      "properties": {
        "objectName": {
          "type": "string",
          "description": "The name of the object to subscribe to in the provider's API. Must match an object type supported by the provider.",
          "examples": [
            "account",
            "contact",
            "lead",
            "opportunity"
          ]
        },
        "destination": {
          "type": "string",
          "description": "The webhook destination for the event data. This determines where the event data will be sent when an event occurs.",
          "examples": [
            "accountWebhook",
            "contactWebhook",
            "defaultWebhook"
          ]
        },
        "inheritFieldsAndMapping": {
          "type": "boolean",
          "description": "Whether to inherit field mappings from read configuration. For Salesforce, this must be set to true.",
          "examples": [
            true
          ]
        },
        "createEvent": {
          "type": "object",
          "description": "Configuration for create events. Triggers when a new record is created.",
          "properties": {
            "enabled": {
              "type": "string",
              "description": "Whether create events are enabled. 'always' means they are always enabled.",
              "enum": [
                "always"
              ],
              "examples": [
                "always"
              ]
            }
          },
          "examples": [
            {
              "enabled": "always"
            }
          ]
        },
        "updateEvent": {
          "type": "object",
          "description": "Configuration for update events. Triggers when an existing record is modified.",
          "properties": {
            "enabled": {
              "type": "string",
              "description": "Whether update events are enabled. 'always' means they are always enabled.",
              "enum": [
                "always"
              ],
              "examples": [
                "always"
              ]
            },
            "watchFieldsAuto": {
              "type": "string",
              "description": "Whether to automatically watch all fields for changes. 'all' watches all fields.",
              "enum": [
                "all"
              ],
              "examples": [
                "all"
              ]
            },
            "requiredWatchFields": {
              "type": "array",
              "description": "List of specific fields to watch for changes. Only events affecting these fields will trigger notifications.",
              "items": {
                "type": "string"
              },
              "examples": [
                [
                  "name",
                  "email",
                  "phone"
                ]
              ]
            }
          },
          "examples": [
            {
              "enabled": "always",
              "watchFieldsAuto": "all"
            },
            {
              "enabled": "always",
              "requiredWatchFields": [
                "name",
                "email",
                "phone"
              ]
            }
          ]
        },
        "deleteEvent": {
          "type": "object",
          "description": "Configuration for delete events. Triggers when a record is removed.",
          "properties": {
            "enabled": {
              "type": "string",
              "description": "Whether delete events are enabled. 'always' means they are always enabled.",
              "enum": [
                "always"
              ],
              "examples": [
                "always"
              ]
            }
          },
          "examples": [
            {
              "enabled": "always"
            }
          ]
        }
      },
      "examples": [
        {
          "objectName": "account",
          "destination": "accountWebhook",
          "inheritFieldsAndMapping": true,
          "createEvent": {
            "enabled": "always"
          },
          "updateEvent": {
            "enabled": "always",
            "watchFieldsAuto": "all"
          },
          "deleteEvent": {
            "enabled": "always"
          }
        },
        {
          "objectName": "contact",
          "destination": "contactWebhook",
          "inheritFieldsAndMapping": true,
          "createEvent": {
            "enabled": "always"
          },
          "updateEvent": {
            "enabled": "always",
            "requiredWatchFields": [
              "name",
              "email",
              "phone"
            ]
          },
          "deleteEvent": {
            "enabled": "always"
          }
        }
      ]
    },
    "proxy": {
      "type": "object",
      "description": "Configuration for proxying API calls to the provider. Enables direct access to the provider's API.",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether proxy is enabled for this integration. If true, API calls can be made directly to the provider through Ampersand's proxy.",
          "default": false,
          "examples": [
            true,
            false
          ]
        }
      },
      "examples": [
        {
          "enabled": true
        }
      ]
    }
  }
}